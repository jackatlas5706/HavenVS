<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Haven - Shadowrealms Fantasy MMORPG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0a 50%, #0d0d0d 100%);
            color: #e8dcc8;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 50%, rgba(139, 69, 19, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
            animation: ambientShift 20s ease-in-out infinite;
        }

        @keyframes ambientShift {
            0%,
            100% {
                opacity: 1;
            }
            50% {
                opacity: 0.8;
            }
        }

        .game-container {
            background: linear-gradient(135deg, rgba(15, 10, 5, 0.95) 0%, rgba(20, 12, 8, 0.95) 100%);
            border: 2px solid #8b5a2b;
            border-radius: 12px;
            box-shadow: 0 0 40px rgba(139, 69, 19, 0.5), inset 0 0 20px rgba(212, 175, 55, 0.05);
            position: relative;
            z-index: 1;
        }

        .stat-bar {
            height: 24px;
            background: linear-gradient(to right, rgba(30, 20, 10, 0.8), rgba(40, 25, 15, 0.8));
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #6b4423;
            margin-top: 6px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .stat-fill {
            height: 100%;
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 0 10px currentColor;
        }

        .health-fill {
            background: linear-gradient(90deg, #ff4444, #ff8844, #ffaa44);
        }
        .energy-fill {
            background: linear-gradient(90deg, #4488ff, #44ccff, #44eeff);
        }
        .glory-fill {
            background: linear-gradient(90deg, #ffdd00, #ffff44, #ffdd00);
        }
        .exp-fill {
            background: linear-gradient(90deg, #aa44ff, #dd44ff, #ff44ff);
        }

        .tab-button {
            background: linear-gradient(to bottom, #9a9a9a, #6a6a6a);
            color: #f0e6d2;
            border: 2px solid #a0a0a0;
            padding: 12px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            white-space: nowrap;
            margin: 4px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .tab-button:hover {
            background: linear-gradient(to bottom, #b5b5b5, #858585);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            border-color: #d4af37;
        }

        .tab-button.active {
            background: linear-gradient(to bottom, #d4af37, #b8860b);
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            color: #1a1a1a;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(to bottom, #a0522d, #6b3410);
            border: 2px solid #c0734d;
            color: #f0e6d2;
            padding: 14px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.4);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(to bottom, #c0734d, #8b4513);
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(139, 69, 19, 0.6);
            border-color: #ffa500;
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(to bottom, #66bb6a, #2e7d32);
            border: 2px solid #81c784;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-success:hover:not(:disabled) {
            background: linear-gradient(to bottom, #81c784, #1b5e20);
            box-shadow: 0 8px 16px rgba(76, 175, 80, 0.5);
        }

        .btn-danger {
            background: linear-gradient(to bottom, #ef5350, #c62828);
            border: 2px solid #f44336;
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }

        .btn-danger:hover:not(:disabled) {
            background: linear-gradient(to bottom, #f44336, #b71c1c);
            box-shadow: 0 8px 16px rgba(244, 67, 54, 0.5);
        }

        .content-panel {
            background: linear-gradient(135deg, rgba(35, 20, 10, 0.8) 0%, rgba(45, 25, 15, 0.8) 100%);
            border: 2px solid #8b5a2b;
            border-radius: 10px;
            padding: 24px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(212, 175, 55, 0.1);
            backdrop-filter: blur(2px);
        }

        .content-panel h2 {
            color: #ffd700;
            border-bottom: 2px solid #8b5a2b;
            padding-bottom: 12px;
            margin-bottom: 18px;
            font-size: 1.6em;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .content-panel h3 {
            color: #ffa500;
            margin: 12px 0;
            font-weight: 600;
        }

        .stat-box {
            background: linear-gradient(135deg, rgba(60, 40, 20, 0.6) 0%, rgba(80, 50, 30, 0.6) 100%);
            border: 2px solid #8b5a2b;
            border-radius: 8px;
            padding: 14px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .stat-box:hover {
            background: linear-gradient(135deg, rgba(80, 50, 30, 0.8) 0%, rgba(100, 60, 40, 0.8) 100%);
            border-color: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255, 215, 0, 0.3);
        }

        .log-panel {
            background: rgba(15, 10, 5, 0.7);
            border: 2px solid #6b4423;
            border-radius: 8px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            height: 280px;
            overflow-y: auto;
            font-size: 0.9em;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .log-message {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #6b4423;
            animation: slideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-weight: 500;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-15px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .log-message.success {
            color: #66ff66;
            text-shadow: 0 0 8px rgba(102, 255, 102, 0.5);
        }
        .log-message.danger {
            color: #ff6666;
            text-shadow: 0 0 8px rgba(255, 102, 102, 0.5);
        }
        .log-message.warning {
            color: #ffcc00;
            text-shadow: 0 0 8px rgba(255, 204, 0, 0.5);
        }
        .log-message.info {
            color: #66ccff;
            text-shadow: 0 0 8px rgba(102, 204, 255, 0.5);
        }

        .auth-form {
            background: linear-gradient(135deg, rgba(20, 12, 8, 0.95) 0%, rgba(30, 18, 10, 0.95) 100%);
            border: 3px solid #8b5a2b;
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 520px;
            box-shadow: 0 0 40px rgba(139, 69, 19, 0.8), inset 0 0 20px rgba(212, 175, 55, 0.1);
            animation: fadeInScale 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .auth-form h2 {
            color: #ffd700;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2.4em;
            font-weight: 800;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.7);
            letter-spacing: 2px;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ffa500;
            font-weight: 700;
            font-size: 0.95em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .form-group input {
            width: 100%;
            padding: 12px 14px;
            background: linear-gradient(to bottom, rgba(30, 20, 10, 0.9), rgba(20, 15, 10, 0.9));
            border: 2px solid #8b5a2b;
            border-radius: 6px;
            color: #e8dcc8;
            transition: all 0.3s;
            font-size: 1em;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .form-group input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 12px rgba(255, 215, 0, 0.5), inset 0 2px 4px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to bottom, rgba(40, 25, 15, 0.95), rgba(30, 20, 10, 0.95));
        }

        .character-card {
            background: linear-gradient(135deg, rgba(35, 20, 10, 0.8) 0%, rgba(45, 25, 15, 0.8) 100%);
            border: 2px solid #8b5a2b;
            border-radius: 10px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .character-card:hover {
            transform: translateY(-6px);
            border-color: #ffd700;
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
            background: linear-gradient(135deg, rgba(50, 30, 15, 0.9) 0%, rgba(60, 35, 20, 0.9) 100%);
        }

        .character-card h3 {
            color: #ffd700;
            margin-bottom: 8px;
            font-weight: 700;
            font-size: 1.1em;
        }

        .combat-log {
            background: rgba(15, 10, 5, 0.7);
            border-radius: 8px;
            padding: 14px;
            height: 280px;
            overflow-y: auto;
            border: 2px solid #6b4423;
            margin-top: 16px;
            font-size: 0.88em;
            font-family: 'Courier New', monospace;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .item-card {
            background: linear-gradient(135deg, rgba(60, 40, 20, 0.6) 0%, rgba(80, 50, 30, 0.6) 100%);
            border: 2px solid #8b5a2b;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .item-card:hover {
            background: linear-gradient(135deg, rgba(80, 50, 30, 0.8) 0%, rgba(100, 60, 40, 0.8) 100%);
            border-color: #ffd700;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(255, 215, 0, 0.3);
        }

        .combat-arena {
            background: linear-gradient(135deg, rgba(40, 25, 20, 0.7) 0%, rgba(50, 30, 25, 0.7) 100%);
            border: 3px solid #8b0000;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 18px;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.3);
        }

        .enemy-card {
            background: linear-gradient(135deg, rgba(60, 25, 25, 0.7) 0%, rgba(80, 35, 35, 0.7) 100%);
            border: 2px solid #ff6b6b;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .quest-card {
            background: linear-gradient(135deg, rgba(30, 30, 60, 0.6) 0%, rgba(40, 40, 80, 0.6) 100%);
            border: 2px solid #4169e1;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 4px 12px rgba(65, 105, 225, 0.2);
        }

        .quest-card:hover {
            background: linear-gradient(135deg, rgba(50, 50, 80, 0.8) 0%, rgba(60, 60, 100, 0.8) 100%);
            border-color: #ffd700;
            transform: translateX(4px);
            box-shadow: 0 6px 16px rgba(255, 215, 0, 0.3);
        }

        .pvp-arena {
            background: linear-gradient(135deg, rgba(80, 20, 80, 0.7) 0%, rgba(100, 30, 100, 0.7) 100%);
            border: 3px solid #d946ef;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 18px;
            box-shadow: 0 0 20px rgba(217, 70, 239, 0.3);
        }

        .dungeon-room {
            background: linear-gradient(135deg, rgba(40, 30, 20, 0.7) 0%, rgba(60, 40, 20, 0.7) 100%);
            border: 2px solid #8b6914;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 4px 12px rgba(139, 105, 20, 0.3);
        }

        .dungeon-room:hover {
            background: linear-gradient(135deg, rgba(60, 40, 20, 0.9) 0%, rgba(80, 50, 30, 0.9) 100%);
            border-color: #ffd700;
            transform: translateX(4px);
            box-shadow: 0 6px 16px rgba(255, 215, 0, 0.3);
        }

        .opponent-card {
            background: linear-gradient(135deg, rgba(60, 30, 30, 0.7) 0%, rgba(80, 40, 40, 0.7) 100%);
            border: 2px solid #ff6b6b;
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.2);
            cursor: pointer;
            transition: all 0.3s;
        }

        .opponent-card:hover {
            background: linear-gradient(135deg, rgba(80, 40, 40, 0.9) 0%, rgba(100, 50, 50, 0.9) 100%);
            border-color: #ff9999;
            transform: translateX(4px);
            box-shadow: 0 6px 16px rgba(255, 107, 107, 0.4);
        }

        .hidden {
            display: none !important;
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(6px);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            background: linear-gradient(135deg, rgba(30, 20, 10, 0.95), rgba(40, 25, 15, 0.95));
            border: 2px solid #d4af37;
            border-radius: 8px;
            color: #ffd700;
            animation: slideInRight 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1000;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .top-bar {
            background: linear-gradient(135deg, rgba(70, 45, 25, 0.8), rgba(50, 35, 20, 0.8));
            border: 2px solid #8b5a2b;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.3);
        }

        .resource-item {
            background: linear-gradient(135deg, rgba(60, 40, 20, 0.6) 0%, rgba(80, 50, 30, 0.6) 100%);
            border: 2px solid #8b5a2b;
            border-radius: 8px;
            padding: 12px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .resource-item:hover {
            background: linear-gradient(135deg, rgba(80, 50, 30, 0.8) 0%, rgba(100, 60, 40, 0.8) 100%);
            border-color: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255, 215, 0, 0.2);
        }

        .scrollbar-custom::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar-custom::-webkit-scrollbar-track {
            background: rgba(20, 15, 10, 0.5);
            border-radius: 10px;
        }

        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #8b5a2b, #6b4423);
            border-radius: 10px;
        }

        .scrollbar-custom::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #a0522d, #8b5a2b);
        }

        .glowing-text {
            text-shadow: 0 0 10px currentColor;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%,
            100% {
                text-shadow: 0 0 10px currentColor;
            }
            50% {
                text-shadow: 0 0 20px currentColor;
            }
        }

        .combat-action-btn {
            position: relative;
            overflow: hidden;
        }

        .combat-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .combat-action-btn:hover::before {
            left: 100%;
        }

        .loading-spinner {
            border: 4px solid rgba(212, 175, 55, 0.3);
            border-top: 4px solid #d4af37;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .error-message {
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid #ff4444;
            color: #ff8888;
            padding: 12px;
            border-radius: 6px;
            margin-top: 8px;
            font-weight: 600;
        }

        .success-message {
            background: rgba(102, 255, 102, 0.2);
            border: 2px solid #66ff66;
            color: #88ff88;
            padding: 12px;
            border-radius: 6px;
            margin-top: 8px;
            font-weight: 600;
        }

        .floor-badge {
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.8), rgba(180, 82, 45, 0.8));
            border: 2px solid #ffa500;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.85em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .reward-badge {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(102, 255, 102, 0.2));
            border: 1px solid #66ff66;
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 0.8em;
            color: #66ff66;
            text-shadow: 0 0 4px rgba(102, 255, 102, 0.5);
            margin-top: 8px;
        }

        .pvp-rank {
            background: linear-gradient(135deg, rgba(217, 70, 239, 0.3), rgba(168, 85, 247, 0.2));
            border: 1px solid #d946ef;
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 0.8em;
            color: #d946ef;
            text-shadow: 0 0 4px rgba(217, 70, 239, 0.5);
        }

        .damage-number {
            position: absolute;
            font-weight: bold;
            font-size: 1.5em;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-40px);
            }
        }

        .achievement-popup {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(212, 175, 55, 0.2));
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 16px 24px;
            animation: slideInUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 999;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .merit-shop-item {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3) 0%, rgba(102, 255, 102, 0.1) 100%);
            border: 2px solid #66ff66;
            border-radius: 10px;
            padding: 16px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 4px 12px rgba(102, 255, 102, 0.2);
        }

        .merit-shop-item:hover {
            background: linear-gradient(135deg, rgba(102, 255, 102, 0.2) 0%, rgba(76, 175, 80, 0.2) 100%);
            border-color: #88ff88;
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(102, 255, 102, 0.4);
        }

        .merit-cost {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.5), rgba(102, 255, 102, 0.3));
            border: 1px solid #66ff66;
            border-radius: 6px;
            padding: 8px 12px;
            font-weight: bold;
            color: #66ff66;
            text-shadow: 0 0 4px rgba(102, 255, 102, 0.5);
            margin-top: 12px;
        }

        .stat-boost-item {
            background: linear-gradient(135deg, rgba(100, 100, 255, 0.2) 0%, rgba(150, 150, 255, 0.1) 100%);
            border: 2px solid #6666ff;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .stat-boost-item:hover {
            background: linear-gradient(135deg, rgba(150, 150, 255, 0.3) 0%, rgba(100, 100, 255, 0.2) 100%);
            border-color: #8888ff;
            transform: translateX(4px);
        }

        .back-button {
            background: linear-gradient(to bottom, #8b5a2b, #6b4423);
            border: 2px solid #a0522d;
            color: #f0e6d2;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin-bottom: 16px;
        }

        .back-button:hover {
            background: linear-gradient(to bottom, #a0522d, #8b5a2b);
            border-color: #c0734d;
        }

        /* Merit Shop Modal Styles */
        #meritShopModal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(20, 12, 8, 0.95), rgba(30, 18, 10, 0.95));
            border: 3px solid #8b5a2b;
            border-radius: 16px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            z-index: 9999;
            box-shadow: 0 0 40px rgba(139, 69, 19, 0.8), inset 0 0 20px rgba(212, 175, 55, 0.1);
            display: none;
            overflow-y: auto;
            max-height: 80vh;
        }

        #meritShopModal.show {
            display: block;
        }

        #meritShopBackdrop {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(4px);
            z-index: 9998;
            display: none;
        }

        #meritShopBackdrop.show {
            display: block;
        }
    </style>
</head>
<body class="p-4">
    <!-- Auth Container -->
    <div id="authContainer" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 modal-overlay">
        <div class="auth-form">
            <h2>‚öîÔ∏è HAVEN</h2>
            <div id="loginForm">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter username" autocomplete="username" />
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password" autocomplete="current-password" />
                </div>
                <div id="loginError" class="error-message hidden"></div>
                <button class="btn-primary w-full mb-4" id="loginBtn">Login</button>
                <p class="text-center text-gray-400">
                    Don't have account?
                    <span class="text-yellow-500 cursor-pointer hover:text-yellow-300 transition font-bold" onclick="toggleAuthForm()">Register</span>
                </p>
            </div>
            <div id="registerForm" class="hidden">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="registerUsername" placeholder="Choose username" autocomplete="username" />
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="registerPassword" placeholder="Choose password" autocomplete="new-password" />
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" id="registerConfirm" placeholder="Confirm password" autocomplete="new-password" />
                </div>
                <div id="registerError" class="error-message hidden"></div>
                <button class="btn-primary w-full mb-4" id="registerBtn">Register</button>
                <p class="text-center text-gray-400">
                    Have account?
                    <span class="text-yellow-500 cursor-pointer hover:text-yellow-300 transition font-bold" onclick="toggleAuthForm()">Login</span>
                </p>
            </div>
        </div>
    </div>

    <!-- Character Selection -->
    <div id="charSelectContainer" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden modal-overlay">
        <div class="auth-form">
            <h2>Select Character</h2>
            <div id="charGrid" class="grid grid-cols-2 gap-4 mb-6 max-h-96 overflow-y-auto scrollbar-custom"></div>
            <button class="btn-primary w-full mb-2" id="createCharBtn">+ Create New Character</button>
            <button class="btn-danger w-full" id="logoutBtn">Logout</button>
        </div>
    </div>

    <!-- Main Game -->
    <div id="gameContainer" class="hidden max-w-7xl mx-auto relative z-10">
        <div class="game-container">
            <!-- Top Bar -->
            <div class="top-bar mb-4">
                <div class="flex justify-between items-center flex-wrap gap-4 mb-4">
                    <div>
                        <h1 class="text-4xl font-black text-yellow-400 glowing-text">‚öîÔ∏è HAVEN</h1>
                        <p class="text-sm text-gray-400 font-semibold" id="charInfo">Loading...</p>
                    </div>
                    <div class="text-right">
                        <div id="currentTime" class="text-gray-300 text-lg font-bold"></div>
                        <button class="btn-primary text-xs mt-2" id="logoutGameBtn">Logout</button>
                    </div>
                </div>

                <!-- Resources -->
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3 text-sm">
                    <div class="resource-item">
                        <div class="text-gray-400 text-xs font-bold">LEVEL</div>
                        <div class="text-yellow-400 font-black text-xl mt-1" id="playerLevel">1</div>
                    </div>
                    <div class="resource-item">
                        <div class="text-gray-400 text-xs font-bold">GOLD</div>
                        <div class="text-yellow-500 font-black text-xl mt-1" id="playerGold">1000</div>
                    </div>
                    <div class="resource-item">
                        <div class="text-gray-400 text-xs font-bold">HEALTH</div>
                        <div class="text-red-400 font-bold text-sm mt-1"><span id="playerHP">100</span>/<span id="maxHP">100</span></div>
                        <div class="stat-bar"><div id="hpBar" class="stat-fill health-fill" style="width: 100%"></div></div>
                    </div>
                    <div class="resource-item">
                        <div class="text-gray-400 text-xs font-bold">ENERGY</div>
                        <div class="text-blue-300 font-bold text-sm mt-1"><span id="playerEnergy">100</span>/<span id="maxEnergy">100</span></div>
                        <div class="stat-bar"><div id="energyBar" class="stat-fill energy-fill" style="width: 100%"></div></div>
                    </div>
                    <div class="resource-item">
                        <div class="text-gray-400 text-xs font-bold">GLORY</div>
                        <div class="text-yellow-300 font-bold text-sm mt-1"><span id="playerGlory">100</span>/<span id="maxGlory">100</span></div>
                        <div class="stat-bar"><div id="gloryBar" class="stat-fill glory-fill" style="width: 100%"></div></div>
                    </div>
                    <div class="resource-item cursor-pointer" id="playerMeritsContainer">
                        <div class="text-gray-400 text-xs font-bold">MERITS</div>
                        <div class="text-green-400 font-black text-xl mt-1" id="playerMerits">50</div>
                    </div>
                    <div class="resource-item">
                        <div class="text-gray-400 text-xs font-bold">JEWELS</div>
                        <div class="text-purple-400 font-black text-xl mt-1" id="playerJewels">0</div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="flex flex-wrap gap-2 mb-4 bg-gray-950 border-2 border-gray-800 rounded-lg p-3 overflow-x-auto scrollbar-custom">
                <button class="tab-button active" data-tab="home" onclick="switchTab('home')">üè† Home</button>
                <button class="tab-button" data-tab="adventure" onclick="switchTab('adventure')">‚öîÔ∏è Adventure</button>
                <button class="tab-button" data-tab="pvp" onclick="switchTab('pvp')">üó°Ô∏è PvP Arena</button>
                <button class="tab-button" data-tab="dungeon" onclick="switchTab('dungeon')">üè∞ Dungeon</button>
                <button class="tab-button" data-tab="training" onclick="switchTab('training')">üí™ Training</button>
                <button class="tab-button" data-tab="market" onclick="switchTab('market')">üè™ Market</button>
                <button class="tab-button" data-tab="inventory" onclick="switchTab('inventory')">üéí Inventory</button>
                <button class="tab-button" data-tab="quests" onclick="switchTab('quests')">üìú Quests</button>
                <!-- Removed Merit Shop Tab Button -->
                <button class="tab-button" data-tab="stats" onclick="switchTab('stats')">üìä Stats</button>
                <button class="tab-button" data-tab="account" onclick="switchTab('account')">‚öôÔ∏è Account</button>
            </div>

            <!-- Content Area -->
            <div class="space-y-4">
                <!-- Home Tab -->
                <div id="homeTab" class="tab-content">
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="content-panel">
                            <h2>üìã Character Info</h2>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-300">Name:</span>
                                    <span id="charName" class="text-yellow-400 font-bold">Adventurer</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-300">Race:</span>
                                    <span id="charRace" class="text-yellow-400 font-bold">Human</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-300">Class:</span>
                                    <span id="charClass" class="text-yellow-400 font-bold">Warrior</span>
                                </div>
                                <div class="mt-4">
                                    <span class="text-gray-400 text-xs">Experience Progress</span>
                                    <div class="text-sm font-bold text-yellow-300 mt-1"><span id="charExp">0</span>/<span id="expNext">500</span> EXP</div>
                                    <div class="stat-bar mt-2"><div id="expBar" class="stat-fill exp-fill" style="width: 0%"></div></div>
                                </div>
                            </div>
                        </div>
                        <div class="content-panel">
                            <h2>‚ö° Battle Stats</h2>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="stat-box">
                                    <div class="text-gray-400 text-xs font-bold">STR</div>
                                    <div class="text-lg font-black text-red-400 mt-2" id="statStr">15</div>
                                </div>
                                <div class="stat-box">
                                    <div class="text-gray-400 text-xs font-bold">DEF</div>
                                    <div class="text-lg font-black text-blue-400 mt-2" id="statDef">12</div>
                                </div>
                                <div class="stat-box">
                                    <div class="text-gray-400 text-xs font-bold">SPD</div>
                                    <div class="text-lg font-black text-yellow-400 mt-2" id="statSpd">10</div>
                                </div>
                                <div class="stat-box">
                                    <div class="text-gray-400 text-xs font-bold">EVA</div>
                                    <div class="text-lg font-black text-green-400 mt-2" id="statEva">8</div>
                                </div>
                            </div>
                        </div>
                        <div class="content-panel">
                            <h2>üéØ Quick Actions</h2>
                            <div class="space-y-2">
                                <button class="btn-primary w-full text-sm" id="quickCombatBtn" onclick="switchTab('adventure')">‚öîÔ∏è Start Combat</button>
                                <button class="btn-primary w-full text-sm" id="quickRestBtn" onclick="restNow()">üò¥ Rest Now</button>
                                <button class="btn-success w-full text-sm" id="quickTrainBtn" onclick="switchTab('training')">üí™ Quick Train</button>
                                <button class="btn-primary w-full text-sm" onclick="switchTab('pvp')">üó°Ô∏è PvP Battle</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Adventure Tab -->
                <div id="adventureTab" class="tab-content hidden">
                    <div class="content-panel">
                        <h2>‚öîÔ∏è Adventure</h2>
                        <p class="text-gray-400 mb-6 font-semibold">Choose your adventure path and test your skills!</p>
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                            <button class="btn-primary w-full combat-action-btn" id="combatBtn" onclick="startCombat()">
                                <div class="text-sm font-bold">‚öîÔ∏è Combat</div>
                                <div class="text-xs text-gray-200">15 Energy</div>
                            </button>
                            <button class="btn-primary w-full combat-action-btn" id="questBtn" onclick="startQuest()">
                                <div class="text-sm font-bold">üìú Quest</div>
                                <div class="text-xs text-gray-200">25 Energy</div>
                            </button>
                            <button class="btn-primary w-full combat-action-btn" onclick="switchTab('pvp')">
                                <div class="text-sm font-bold">üó°Ô∏è PvP Arena</div>
                                <div class="text-xs text-gray-200">25 Energy</div>
                            </button>
                        </div>

                        <div id="combatArea" class="hidden">
                            <div class="combat-arena">
                                <h3 class="text-center mb-6 text-xl font-black text-yellow-400 glowing-text">‚öîÔ∏è COMBAT ARENA</h3>
                                <div class="grid md:grid-cols-2 gap-4 mb-6">
                                    <div>
                                        <div class="text-center text-yellow-500 font-black mb-3">YOU</div>
                                        <div class="bg-gray-950 p-4 rounded-lg border-2 border-blue-900">
                                            <div class="text-sm mb-3 font-bold">Health: <span id="playerCombatHP" class="text-red-400">100</span>/<span id="playerCombatMaxHP" class="text-gray-400">100</span></div>
                                            <div class="stat-bar"><div id="playerCombatHPBar" class="stat-fill health-fill" style="width: 100%"></div></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-center text-red-500 font-black mb-3" id="enemyName">Enemy</div>
                                        <div class="enemy-card">
                                            <div class="text-sm mb-3 font-bold">Health: <span id="enemyHP" class="text-red-400">80</span>/<span id="enemyMaxHP" class="text-gray-400">80</span></div>
                                            <div class="stat-bar"><div id="enemyHPBar" class="stat-fill health-fill" style="width: 100%"></div></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid md:grid-cols-3 gap-3 mb-6">
                                    <button class="btn-primary combat-action-btn" id="attackBtn" onclick="playerAttack()">‚öîÔ∏è Attack</button>
                                    <button class="btn-primary combat-action-btn" id="defendBtn" onclick="playerDefend()">üõ°Ô∏è Defend</button>
                                    <button class="btn-primary combat-action-btn" id="skillBtn" onclick="playerSkill()">‚ú® Skill</button>
                                </div>

                                <div class="combat-log scrollbar-custom" id="combatLog">
                                    <div class="log-message info">Combat started! Choose your action.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PvP Arena Tab -->
                <div id="pvpTab" class="tab-content hidden">
                    <div class="content-panel">
                        <h2>üó°Ô∏è PvP Arena</h2>
                        <p class="text-gray-400 mb-6 font-semibold">Challenge other players and climb the ranks!</p>
                        <div id="pvpOpponents" class="space-y-3 mb-6">
                            <div class="opponent-card" onclick="challengeOpponent('Player1', 15)">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-yellow-400">Player1</span>
                                    <span class="pvp-rank">Rank: Gold</span>
                                </div>
                                <div class="text-xs text-gray-400 mt-2">Level 25 ‚Ä¢ Wins: 45</div>
                            </div>
                            <div class="opponent-card" onclick="challengeOpponent('Player2', 18)">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-yellow-400">Player2</span>
                                    <span class="pvp-rank">Rank: Silver</span>
                                </div>
                                <div class="text-xs text-gray-400 mt-2">Level 22 ‚Ä¢ Wins: 32</div>
                            </div>
                            <div class="opponent-card" onclick="challengeOpponent('Player3', 20)">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-yellow-400">Player3</span>
                                    <span class="pvp-rank">Rank: Bronze</span>
                                </div>
                                <div class="text-xs text-gray-400 mt-2">Level 20 ‚Ä¢ Wins: 18</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dungeon Tab -->
                <div id="dungeonTab" class="tab-content hidden">
                    <div class="content-panel">
                        <h2>üè∞ Dungeon</h2>
                        <p class="text-gray-400 mb-6 font-semibold">Explore dangerous dungeons and find legendary treasures!</p>
                        <div id="dungeonRooms" class="space-y-3">
                            <div class="dungeon-room">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-yellow-400">Floor 1: Goblin Warren</span>
                                    <span class="floor-badge">Difficulty: Easy</span>
                                </div>
                                <div class="text-xs text-gray-400 mt-2">Enemies: 5 Goblins | Rewards: 200 Gold, 100 EXP</div>
                                <button class="btn-success text-xs mt-3" onclick="enterDungeon(1)">Enter</button>
                            </div>
                            <div class="dungeon-room">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-yellow-400">Floor 2: Skeleton Crypt</span>
                                    <span class="floor-badge">Difficulty: Medium</span>
                                </div>
                                <div class="text-xs text-gray-400 mt-2">Enemies: 8 Skeletons | Rewards: 400 Gold, 250 EXP</div>
                                <button class="btn-success text-xs mt-3" onclick="enterDungeon(2)">Enter</button>
                            </div>
                            <div class="dungeon-room">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-yellow-400">Floor 3: Dragon's Lair</span>
                                    <span class="floor-badge">Difficulty: Hard</span>
                                </div>
                                <div class="text-xs text-gray-400 mt-2">Enemies: 1 Dragon | Rewards: 1000 Gold, 500 EXP</div>
                                <button class="btn-success text-xs mt-3" onclick="enterDungeon(3)">Enter</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Training Tab -->
                <div id="trainingTab" class="tab-content hidden">
                    <div class="content-panel">
                        <h2>üí™ Training</h2>
                        <p class="text-gray-400 mb-6 font-semibold">Improve your stats through intense training!</p>
                        <div class="grid md:grid-cols-2 gap-4">
                            <button class="btn-primary w-full text-sm" onclick="trainStat('STR')">
                                <div class="font-bold">üí™ Strength Training</div>
                                <div class="text-xs text-gray-200">Cost: 50 Gold | Gain: +2 STR</div>
                            </button>
                            <button class="btn-primary w-full text-sm" onclick="trainStat('DEF')">
                                <div class="font-bold">üõ°Ô∏è Defense Training</div>
                                <div class="text-xs text-gray-200">Cost: 50 Gold | Gain: +2 DEF</div>
                            </button>
                            <button class="btn-primary w-full text-sm" onclick="trainStat('SPD')">
                                <div class="font-bold">‚ö° Speed Training</div>
                                <div class="text-xs text-gray-200">Cost: 50 Gold | Gain: +2 SPD</div>
                            </button>
                            <button class="btn-primary w-full text-sm" onclick="trainStat('EVA')">
                                <div class="font-bold">üéØ Evasion Training</div>
                                <div class="text-xs text-gray-200">Cost: 50 Gold | Gain: +2 EVA</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Market Tab -->
                <div id="marketTab" class="tab-content hidden">
                    <div class="content-panel">
                        <h2>üè™ Market</h2>
                        <p class="text-gray-400 mb-6 font-semibold">Buy and sell items to enhance your power!</p>
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="item-card">
                                <div class="font-bold text-yellow-400">Iron Sword</div>
                                <div class="text-xs text-gray-400 mt-2">+5 STR</div>
                                <div class="text-yellow-500 font-bold mt-2">300 Gold</div>
                                <button class="btn-success text-xs w-full mt-2" onclick="buyItem('Iron Sword', 300)">Buy</button>
                            </div>
                            <div class="item-card">
                                <div class="font-bold text-yellow-400">Steel Shield</div>
                                <div class="text-xs text-gray-400 mt-2">+8 DEF</div>
                                <div class="text-yellow-500 font-bold mt-2">400 Gold</div>
                                <button class="btn-success text-xs w-full mt-2" onclick="buyItem('Steel Shield', 400)">Buy</button>
                            </div>
                            <div class="item-card">
                                <div class="font-bold text-yellow-400">Speed Boots</div>
                                <div class="text-xs text-gray-400 mt-2">+6 SPD</div>
                                <div class="text-yellow-500 font-bold mt-2">350 Gold</div>
                                <button class="btn-success text-xs w-full mt-2" onclick="buyItem('Speed Boots', 350)">Buy</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inventory Tab -->
                <div id="inventoryTab" class="tab-content hidden">
                    <div class="content-panel">
                        <h2>üéí Inventory</h2>
                        <div id="inventoryList" class="space-y-2 text-sm">
                            <div class="text-gray-400">Your inventory is empty</div>
                        </div>
                    </div>
                </div>

                <!-- Quests Tab -->
                <div id="questsTab" class="tab-content hidden">
                    <div class="content-panel">
                        <h2>üìú Quests</h2>
                        <p class="text-gray-400 mb-6 font-semibold">Complete quests to earn rewards!</p>
                        <div id="questsList" class="space-y-3">
                            <div class="quest-card">
                                <div class="font-bold text-yellow-400">Defeat 10 Goblins</div>
                                <div class="text-xs text-gray-400 mt-2">Progress: 0/10</div>
                                <div class="reward-badge mt-3">Reward: 500 Gold + 200 EXP</div>
                            </div>
                            <div class="quest-card">
                                <div class="font-bold text-yellow-400">Reach Level 10</div>
                                <div class="text-xs text-gray-400 mt-2">Progress: 1/10</div>
                                <div class="reward-badge mt-3">Reward: 1000 Gold + 500 EXP</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Tab -->
                <div id="statsTab" class="tab-content hidden">
                    <div class="content-panel">
                        <h2>üìä Character Statistics</h2>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h3>Core Stats</h3>
                                <div class="space-y-3 mt-4">
                                    <div class="flex justify-between items-center text-sm">
                                        <span class="text-gray-300">Strength (STR):</span>
                                        <span id="statsStr" class="text-red-400 font-bold">15</span>
                                    </div>
                                    <div class="flex justify-between items-center text-sm">
                                        <span class="text-gray-300">Defense (DEF):</span>
                                        <span id="statsDef" class="text-blue-400 font-bold">12</span>
                                    </div>
                                    <div class="flex justify-between items-center text-sm">
                                        <span class="text-gray-300">Speed (SPD):</span>
                                        <span id="statsSpd" class="text-yellow-400 font-bold">10</span>
                                    </div>
                                    <div class="flex justify-between items-center text-sm">
                                        <span class="text-gray-300">Evasion (EVA):</span>
                                        <span id="statsEva" class="text-green-400 font-bold">8</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3>Achievements</h3>
                                <div class="space-y-2 mt-4 text-sm">
                                    <div class="text-gray-400">üèÜ First Steps - Reach Level 5</div>
                                    <div class="text-gray-400">‚öîÔ∏è Warrior - Win 10 Combats</div>
                                    <div class="text-gray-400">üêâ Dragon Slayer - Defeat Dragon Boss</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Tab -->
                <div id="accountTab" class="tab-content hidden">
                    <div class="content-panel">
                        <h2>‚öôÔ∏è Account Settings</h2>
                        <div class="space-y-4">
                            <div class="text-sm">
                                <span class="text-gray-400">Account Status:</span>
                                <span class="text-green-400 font-bold ml-2">Active</span>
                            </div>
                            <div class="text-sm">
                                <span class="text-gray-400">Member Since:</span>
                                <span class="text-yellow-400 font-bold ml-2" id="memberSince">Today</span>
                            </div>
                            <button class="btn-danger w-full mt-6" id="deleteCharBtn" onclick="deleteCharacter()">Delete Character</button>
                            <button class="btn-danger w-full" id="logoutAccBtn" onclick="logout()">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Merit Shop Modal -->
    <div id="meritShopBackdrop"></div>
    <div id="meritShopModal">
        <button class="btn-danger mb-4" onclick="hideMeritShop()">Close</button>
        <h2>üíö Merit Shop</h2>
        <div class="flex justify-between items-center mb-6">
            <p class="text-gray-400 font-semibold">Spend your merits on powerful upgrades and permanent boosts!</p>
            <div class="text-2xl font-black text-green-400">üíö <span id="meritShopBalanceModal">50</span></div>
        </div>

        <!-- Stat Boosts Section -->
        <h3 class="text-yellow-400 font-bold text-lg mb-4">‚ö° Permanent Stat Boosts</h3>
        <div class="grid md:grid-cols-2 gap-4 mb-8">
            <div class="merit-shop-item">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="font-bold text-green-300">üí™ Strength Boost</div>
                        <div class="text-xs text-gray-400 mt-1">Permanently +3 STR</div>
                    </div>
                    <div class="merit-cost">20 Merits</div>
                </div>
                <button class="btn-success w-full text-sm" onclick="buyMeritItem('Strength Boost', 20, 'str', 3)">Purchase</button>
            </div>

            <div class="merit-shop-item">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="font-bold text-green-300">üõ°Ô∏è Defense Boost</div>
                        <div class="text-xs text-gray-400 mt-1">Permanently +3 DEF</div>
                    </div>
                    <div class="merit-cost">20 Merits</div>
                </div>
                <button class="btn-success w-full text-sm" onclick="buyMeritItem('Defense Boost', 20, 'def', 3)">Purchase</button>
            </div>

            <div class="merit-shop-item">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="font-bold text-green-300">‚ö° Speed Boost</div>
                        <div class="text-xs text-gray-400 mt-1">Permanently +3 SPD</div>
                    </div>
                    <div class="merit-cost">20 Merits</div>
                </div>
                <button class="btn-success w-full text-sm" onclick="buyMeritItem('Speed Boost', 20, 'spd', 3)">Purchase</button>
            </div>

            <div class="merit-shop-item">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="font-bold text-green-300">üéØ Evasion Boost</div>
                        <div class="text-xs text-gray-400 mt-1">Permanently +3 EVA</div>
                    </div>
                    <div class="merit-cost">20 Merits</div>
                </div>
                <button class="btn-success w-full text-sm" onclick="buyMeritItem('Evasion Boost', 20, 'eva', 3)">Purchase</button>
            </div>
        </div>

        <!-- Health & Energy Boosts -->
        <h3 class="text-yellow-400 font-bold text-lg mb-4">‚ù§Ô∏è Health & Energy Boosts</h3>
        <div class="grid md:grid-cols-2 gap-4 mb-8">
            <div class="merit-shop-item">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="font-bold text-green-300">‚ù§Ô∏è Max Health Increase</div>
                        <div class="text-xs text-gray-400 mt-1">Permanently +20 Max HP</div>
                    </div>
                    <div class="merit-cost">25 Merits</div>
                </div>
                <button class="btn-success w-full text-sm" onclick="buyMeritItem('Health Increase', 25, 'maxHp', 20)">Purchase</button>
            </div>

            <div class="merit-shop-item">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="font-bold text-green-300">‚ö° Max Energy Increase</div>
                        <div class="text-xs text-gray-400 mt-1">Permanently +20 Max Energy</div>
                    </div>
                    <div class="merit-cost">25 Merits</div>
                </div>
                <button class="btn-success w-full text-sm" onclick="buyMeritItem('Energy Increase', 25, 'maxEnergy', 20)">Purchase</button>
            </div>
        </div>

        <!-- Special Items -->
        <h3 class="text-yellow-400 font-bold text-lg mb-4">‚ú® Special Items</h3>
        <div class="grid md:grid-cols-2 gap-4 mb-8">
            <div class="merit-shop-item">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="font-bold text-green-300">üíé Premium Jewel</div>
                        <div class="text-xs text-gray-400 mt-1">Gain 1 Premium Jewel</div>
                    </div>
                    <div class="merit-cost">15 Merits</div>
                </div>
                <button class="btn-success w-full text-sm" onclick="buyMeritItem('Premium Jewel', 15, 'jewels', 1)">Purchase</button>
            </div>

            <div class="merit-shop-item">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="font-bold text-green-300">üåü Experience Multiplier</div>
                        <div class="text-xs text-gray-400 mt-1">+25% EXP for 1 hour</div>
                    </div>
                    <div class="merit-cost">30 Merits</div>
                </div>
                <button class="btn-success w-full text-sm" onclick="buyMeritItem('EXP Multiplier', 30, 'expBoost', 1)">Purchase</button>
            </div>

            <div class="merit-shop-item">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="font-bold text-green-300">üí∞ Gold Multiplier</div>
                        <div class="text-xs text-gray-400 mt-1">+50% Gold for 1 hour</div>
                    </div>
                    <div class="merit-cost">35 Merits</div>
                </div>
                <button class="btn-success w-full text-sm" onclick="buyMeritItem('Gold Multiplier', 35, 'goldBoost', 1)">Purchase</button>
            </div>

            <div class="merit-shop-item">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="font-bold text-green-300">‚öîÔ∏è Combat Power</div>
                        <div class="text-xs text-gray-400 mt-1">+2 All Stats for 1 hour</div>
                    </div>
                    <div class="merit-cost">40 Merits</div>
                </div>
                <button class="btn-success w-full text-sm" onclick="buyMeritItem('Combat Power', 40, 'combatPower', 1)">Purchase</button>
            </div>
        </div>

        <!-- Purchased Items -->
        <h3 class="text-yellow-400 font-bold text-lg mb-4">üì¶ Your Purchases</h3>
        <div id="purchasedItemsModal" class="bg-gray-950 border-2 border-gray-800 rounded-lg p-4">
            <div class="text-gray-400 text-sm">No items purchased yet</div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            currentUser: null,
            currentCharacter: null,
            characters: {},
            users: JSON.parse(localStorage.getItem('users')) || {},
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            updateTime();
            setInterval(updateTime, 1000);
        });

        function setupEventListeners() {
            document.getElementById('loginBtn').addEventListener('click', login);
            document.getElementById('registerBtn').addEventListener('click', register);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('logoutGameBtn').addEventListener('click', logout);
            document.getElementById('logoutAccBtn').addEventListener('click', logout);
            document.getElementById('createCharBtn').addEventListener('click', openCreateChar);
            document.getElementById('playerMeritsContainer').addEventListener('click', () => {
                showMeritShop();
            });
        }

        function toggleAuthForm() {
            document.getElementById('loginForm').classList.toggle('hidden');
            document.getElementById('registerForm').classList.toggle('hidden');
            document.getElementById('loginError').classList.add('hidden');
            document.getElementById('registerError').classList.add('hidden');
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            if (!username || !password) {
                showError(errorDiv, 'Please fill in all fields');
                return;
            }

            if (!gameState.users[username] || gameState.users[username].password !== password) {
                showError(errorDiv, 'Invalid username or password');
                return;
            }

            gameState.currentUser = username;
            gameState.characters = gameState.users[username].characters || {};
            showCharacterSelection();
        }

        function register() {
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const confirm = document.getElementById('registerConfirm').value;
            const errorDiv = document.getElementById('registerError');

            if (!username || !password || !confirm) {
                showError(errorDiv, 'Please fill in all fields');
                return;
            }

            if (password !== confirm) {
                showError(errorDiv, 'Passwords do not match');
                return;
            }

            if (gameState.users[username]) {
                showError(errorDiv, 'Username already exists');
                return;
            }

            gameState.users[username] = { password, characters: {} };
            localStorage.setItem('users', JSON.stringify(gameState.users));
            showNotification('Account created! Please login.');
            toggleAuthForm();
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }

        function showCharacterSelection() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('charSelectContainer').classList.remove('hidden');
            refreshCharacterList();
        }

        function refreshCharacterList() {
            const charGrid = document.getElementById('charGrid');
            charGrid.innerHTML = '';

            if (Object.keys(gameState.characters).length === 0) {
                charGrid.innerHTML = '<div class="col-span-2 text-center text-gray-400">No characters yet</div>';
                return;
            }

            for (const charName in gameState.characters) {
                const char = gameState.characters[charName];
                const card = document.createElement('div');
                card.className = 'character-card';
                card.onclick = () => selectCharacter(charName);
                card.innerHTML = `
                    <h3>${charName}</h3>
                    <div class="text-xs text-gray-400">${char.race} ${char.class}</div>
                    <div class="text-sm text-yellow-400 mt-2">Level ${char.level}</div>
                `;
                charGrid.appendChild(card);
            }
        }

        function openCreateChar() {
            const charName = prompt('Enter character name:');
            if (!charName) return;

            if (gameState.characters[charName]) {
                alert('Character already exists');
                return;
            }

            const race = prompt('Choose race (Human/Elf/Dwarf):') || 'Human';
            const charClass = prompt('Choose class (Warrior/Mage/Rogue):') || 'Warrior';

            gameState.characters[charName] = {
                name: charName,
                race: race,
                class: charClass,
                level: 1,
                exp: 0,
                hp: 100,
                maxHp: 100,
                energy: 100,
                maxEnergy: 100,
                glory: 100,
                maxGlory: 100,
                gold: 1000,
                merits: 50,
                jewels: 0,
                stats: { str: 15, def: 12, spd: 10, eva: 8 },
                inventory: [],
                meritPurchases: [],
                createdAt: new Date().toLocaleDateString(),
            };

            gameState.users[gameState.currentUser].characters = gameState.characters;
            localStorage.setItem('users', JSON.stringify(gameState.users));
            refreshCharacterList();
            showNotification(`${charName} created!`);
        }

        function selectCharacter(charName) {
            gameState.currentCharacter = gameState.characters[charName];
            document.getElementById('charSelectContainer').classList.add('hidden');
            document.getElementById('gameContainer').classList.remove('hidden');
            loadCharacterUI();
        }

        function loadCharacterUI() {
            const char = gameState.currentCharacter;
            document.getElementById('charInfo').textContent = `${char.name} ‚Ä¢ ${char.race} ${char.class}`;
            document.getElementById('charName').textContent = char.name;
            document.getElementById('charRace').textContent = char.race;
            document.getElementById('charClass').textContent = char.class;
            document.getElementById('playerLevel').textContent = char.level;
            document.getElementById('playerGold').textContent = char.gold;
            document.getElementById('playerHP').textContent = char.hp;
            document.getElementById('maxHP').textContent = char.maxHp;
            document.getElementById('playerEnergy').textContent = char.energy;
            document.getElementById('maxEnergy').textContent = char.maxEnergy;
            document.getElementById('playerGlory').textContent = char.glory;
            document.getElementById('maxGlory').textContent = char.maxGlory;
            document.getElementById('playerMerits').textContent = char.merits;
            document.getElementById('playerJewels').textContent = char.jewels;
            document.getElementById('meritShopBalanceModal').textContent = char.merits;
            document.getElementById('charExp').textContent = char.exp;
            document.getElementById('expNext').textContent = char.level * 500;
            document.getElementById('statStr').textContent = char.stats.str;
            document.getElementById('statDef').textContent = char.stats.def;
            document.getElementById('statSpd').textContent = char.stats.spd;
            document.getElementById('statEva').textContent = char.stats.eva;
            document.getElementById('memberSince').textContent = char.createdAt;
            updateMeritPurchases();
            updateMeritPurchasesModal();
            updateBars();
        }

        function updateMeritPurchases() {
            const char = gameState.currentCharacter;
            const container = document.getElementById('purchasedItems');

            if (!char.meritPurchases || char.meritPurchases.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-sm">No items purchased yet</div>';
                return;
            }

            container.innerHTML = char.meritPurchases
                .map(
                    (item) => `
                <div class="stat-boost-item">
                    <div class="flex justify-between items-center">
                        <span>${item.name}</span>
                        <span class="text-xs text-green-400">‚úì Applied</span>
                    </div>
                </div>
            `
                )
                .join('');
        }

        function updateMeritPurchasesModal() {
            const char = gameState.currentCharacter;
            const container = document.getElementById('purchasedItemsModal');
            if (!container) return;

            if (!char.meritPurchases || char.meritPurchases.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-sm">No items purchased yet</div>';
                return;
            }

            container.innerHTML = char.meritPurchases
                .map(
                    (item) => `
                <div class="stat-boost-item">
                    <div class="flex justify-between items-center">
                        <span>${item.name}</span>
                        <span class="text-xs text-green-400">‚úì Applied</span>
                    </div>
                </div>
            `
                )
                .join('');
        }

        function buyMeritItem(itemName, cost, statType, value) {
            const char = gameState.currentCharacter;

            if (char.merits < cost) {
                showNotification('Not enough merits!');
                return;
            }

            char.merits -= cost;

            // Apply the boost
            if (statType === 'str' || statType === 'def' || statType === 'spd' || statType === 'eva') {
                char.stats[statType] += value;
            } else if (statType === 'maxHp') {
                char.maxHp += value;
                char.hp = char.maxHp;
            } else if (statType === 'maxEnergy') {
                char.maxEnergy += value;
                char.energy = char.maxEnergy;
            } else if (statType === 'jewels') {
                char.jewels += value;
            }

            // Track purchase
            if (!char.meritPurchases) {
                char.meritPurchases = [];
            }
            char.meritPurchases.push({ name: itemName, cost: cost });

            // Save to localStorage
            gameState.users[gameState.currentUser].characters = gameState.characters;
            localStorage.setItem('users', JSON.stringify(gameState.users));

            loadCharacterUI();
            showNotification(`‚ú® ${itemName} purchased for ${cost} merits!`);
        }

        function updateBars() {
            const char = gameState.currentCharacter;
            document.getElementById('hpBar').style.width = (char.hp / char.maxHp) * 100 + '%';
            document.getElementById('energyBar').style.width = (char.energy / char.maxEnergy) * 100 + '%';
            document.getElementById('gloryBar').style.width = (char.glory / char.maxGlory) * 100 + '%';
            document.getElementById('expBar').style.width = (char.exp / (char.level * 500)) * 100 + '%';
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach((tab) => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach((btn) => btn.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            const btn = document.querySelector(`[data-tab="${tabName}"]`);
            if (btn) btn.classList.add('active');
        }

        function startCombat() {
            const char = gameState.currentCharacter;
            if (char.energy < 15) {
                showNotification('Not enough energy!');
                return;
            }
            char.energy = Math.max(0, char.energy - 15);
            document.getElementById('combatArea').classList.remove('hidden');
            document.getElementById('playerCombatHP').textContent = char.hp;
            document.getElementById('playerCombatMaxHP').textContent = char.maxHp;
            document.getElementById('playerCombatHPBar').style.width = '100%';
            document.getElementById('enemyHP').textContent = 80;
            document.getElementById('enemyMaxHP').textContent = 80;
            document.getElementById('enemyHPBar').style.width = '100%';
            document.getElementById('combatLog').innerHTML = '<div class="log-message info">Combat started! Choose your action.</div>';
            updateBars();
        }

        function playerAttack() {
            const damage = Math.floor(Math.random() * 20) + 10;
            const enemyHP = parseInt(document.getElementById('enemyHP').textContent);
            const newEnemyHP = Math.max(0, enemyHP - damage);
            document.getElementById('enemyHP').textContent = newEnemyHP;
            document.getElementById('enemyHPBar').style.width = (newEnemyHP / 80) * 100 + '%';
            addCombatLog(`You attack for ${damage} damage!`, 'success');

            if (newEnemyHP <= 0) {
                endCombat(true);
                return;
            }

            setTimeout(() => enemyAttack(), 500);
        }

        function playerDefend() {
            addCombatLog('You take a defensive stance!', 'info');
            setTimeout(() => {
                const damage = Math.floor(Math.random() * 8) + 2;
                const playerHP = parseInt(document.getElementById('playerCombatHP').textContent);
                const newPlayerHP = Math.max(0, playerHP - damage);
                document.getElementById('playerCombatHP').textContent = newPlayerHP;
                document.getElementById('playerCombatHPBar').style.width = (newPlayerHP / gameState.currentCharacter.maxHp) * 100 + '%';
                addCombatLog(`Enemy attacks! You take ${damage} damage.`, 'danger');

                if (newPlayerHP <= 0) {
                    endCombat(false);
                }
            }, 500);
        }

        function playerSkill() {
            const damage = Math.floor(Math.random() * 35) + 20;
            const enemyHP = parseInt(document.getElementById('enemyHP').textContent);
            const newEnemyHP = Math.max(0, enemyHP - damage);
            document.getElementById('enemyHP').textContent = newEnemyHP;
            document.getElementById('enemyHPBar').style.width = (newEnemyHP / 80) * 100 + '%';
            addCombatLog(`You use special skill for ${damage} damage!`, 'success');

            if (newEnemyHP <= 0) {
                endCombat(true);
                return;
            }

            setTimeout(() => enemyAttack(), 500);
        }

        function enemyAttack() {
            const damage = Math.floor(Math.random() * 15) + 5;
            const playerHP = parseInt(document.getElementById('playerCombatHP').textContent);
            const newPlayerHP = Math.max(0, playerHP - damage);
            document.getElementById('playerCombatHP').textContent = newPlayerHP;
            document.getElementById('playerCombatHPBar').style.width = (newPlayerHP / gameState.currentCharacter.maxHp) * 100 + '%';
            addCombatLog(`Enemy attacks for ${damage} damage!`, 'danger');

            if (newPlayerHP <= 0) {
                endCombat(false);
            }
        }

        function endCombat(won) {
            if (won) {
                const reward = Math.floor(Math.random() * 200) + 100;
                gameState.currentCharacter.gold += reward;
                gameState.currentCharacter.exp += 50;
                addCombatLog(`Victory! You earned ${reward} gold and 50 EXP!`, 'success');
                showNotification('Combat won!');
            } else {
                gameState.currentCharacter.hp = gameState.currentCharacter.maxHp;
                addCombatLog('Defeat! You were defeated...', 'danger');
                showNotification('Combat lost!');
            }
            document.getElementById('combatArea').classList.add('hidden');
            loadCharacterUI();
        }

        function addCombatLog(message, type = 'info') {
            const log = document.getElementById('combatLog');
            const msgDiv = document.createElement('div');
            msgDiv.className = `log-message ${type}`;
            msgDiv.textContent = message;
            log.appendChild(msgDiv);
            log.scrollTop = log.scrollHeight;
        }

        function startQuest() {
            showNotification('Quest started!');
        }

        function challengeOpponent(name, level) {
            showNotification(`You challenged ${name}!`);
        }

        function enterDungeon(floor) {
            showNotification(`Entered Floor ${floor}!`);
        }

        function trainStat(stat) {
            const char = gameState.currentCharacter;
            if (char.gold < 50) {
                showNotification('Not enough gold!');
                return;
            }
            char.gold -= 50;
            const statKey = stat.toLowerCase();
            char.stats[statKey] += 2;
            loadCharacterUI();
            showNotification(`${stat} +2!`);
        }

        function buyItem(itemName, price) {
            const char = gameState.currentCharacter;
            if (char.gold < price) {
                showNotification('Not enough gold!');
                return;
            }
            char.gold -= price;
            char.inventory.push(itemName);
            loadCharacterUI();
            showNotification(`Bought ${itemName}!`);
        }

        function restNow() {
            const char = gameState.currentCharacter;
            char.hp = char.maxHp;
            char.energy = char.maxEnergy;
            loadCharacterUI();
            showNotification('You rested and recovered!');
        }

        function deleteCharacter() {
            if (!confirm('Are you sure? This cannot be undone!')) return;
            delete gameState.characters[gameState.currentCharacter.name];
            gameState.users[gameState.currentUser].characters = gameState.characters;
            localStorage.setItem('users', JSON.stringify(gameState.users));
            document.getElementById('gameContainer').classList.add('hidden');
            showCharacterSelection();
        }

        function logout() {
            gameState.currentUser = null;
            gameState.currentCharacter = null;
            document.getElementById('gameContainer').classList.add('hidden');
            document.getElementById('charSelectContainer').classList.add('hidden');
            document.getElementById('authContainer').classList.remove('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
        }

        function showError(element, message) {
            element.textContent = message;
            element.classList.remove('hidden');
        }

        function showNotification(message) {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        // Merit Shop Modal functions
        const meritShopModal = document.getElementById('meritShopModal');
        const meritShopBackdrop = document.getElementById('meritShopBackdrop');

        function showMeritShop() {
            meritShopModal.classList.add('show');
            meritShopBackdrop.classList.add('show');

            // Update balance inside modal
            if (gameState.currentCharacter) {
                document.getElementById('meritShopBalanceModal').textContent = gameState.currentCharacter.merits;
                updateMeritPurchasesModal();
            }
        }

        function hideMeritShop() {
            meritShopModal.classList.remove('show');
            meritShopBackdrop.classList.remove('show');
        }
    </script>
</body>
</html>
